{% extends "company_base.html" %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block app_content %}
{% include 'inventory_management/inventory_manager_nav.html' %}	
    <h3 class="inventory_headers">Create Orders</h3>
	<a class="create_orders" href="{{ url_for('orders', company_name=company.company_name)}}">Manage Orders</a>
	<hr class="inventory_hr">
    <div class="row sidenav" id="create_orders_sidenav">
		<div class="col-md-12 registerContainer" id="create_orders_form_container">
			<button type="button" class="btn btn-default hide_sidenav" aria-label="Left Align">
				<span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span>
			</button>
			{% if form %}
			{{ wtf.quick_form(form) }}
			<br>
			{% endif %}
			<br>
			
			<table class="table table-bordered table-hover" id="create_order_table">
			<tr>
				<th class="col-md-6" style="width:400px;">Ref No</th>
				<th class="col-md-6" style="width:600px;">Name</th>
				<th class="col-md-1" style="width:40px;">Quantity Remaining </th>
			</tr>
			{% if my_products %}
				{% for my_p in my_products %}
				<tr class="my_products_row">
					<td>{{ my_p.ref_number }}</td>
					<td>{{ my_p.name }}</td>
					<td></td>
					<td><a href="#" class="add_item_to_order" id="add_{{ my_p.ref_number }}">{{ ('Add') }}</a></td>
				</tr>
				{% endfor %}
			{% endif %}
		</table>
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
		<button type="button" class="btn btn-default" id="open_orders_sidenav" aria-label="Left Align">
			<span>Add items</span>
			<span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span>
		</button>
		<span class="text-center"><h4>Order No: {{ order.order_no }}</h4></span>
		<table class="table table-bordered table-hover" id="orders_list_table">
			<tr>
				<th>Reference No</th>
				<th>Name</th>
				<th>Price Each</th>
				<th>Quantity</th>
				<th>Total Price</th>
			</tr>
			{% if order_list %}
				{% for order in order_list %}
				<tr>
					<td>{{ order.ref_no }}</td>
					<td>{{ order.name }}</td>
					<td>{{ order.price }}</td>
					<td><div contenteditable>{{ order.quantity }}</div></td>
					<td id="total_price"></td>
				</tr>
				{% endfor %}
			{% endif %}
		</table>
		
		</div>
    </div>
{% endblock %}
{% block scripts %}
	{{ super() }}
	<script>
		$(document).ready(function() {
			$('input#search_create_orders').quicksearch('table#create_order_table .my_products_row');
			
			var items = [
				{% for my_p in my_products %}
					{
						refnum: "{{ my_p.ref_number}}",
						name: "{{ my_p.name }}",
						price: "{{ my_p.price }}",
		
					},
				{% endfor %}
			]
			{% for my_p in my_products %}
				$("#add_{{ my_p.ref_number }}").click(function() {
					$('#orders_list_table > tbody:last-child').append('<tr><td>{{ my_p.ref_number}}</td><td>{{ my_p.name }}</td><td>{{ my_p.price }}</td><td id="quantity_request_{{ my_p.ref_number}}"><div contenteditable>1</div></td><td id="total_price_{{ my_p.ref_number}}">{{ my_p.price }}</td></tr>');
				});
				
				
				$("#quantity_request_{{ my_p.ref_number}}").keyup(function() {
					var total_{{ my_p.ref_number}} = parseFloat({{ my_p.price }}) * $("#quantity_request_{{ my_p.ref_number}}");
					$("#total_price_{{ my_p.ref_number}}").val(total_{{ my_p.ref_number}});
				});
				/*var total_{{ my_p.ref_number}} = parseFloat({{ my_p.price }});
				$("#total_price_{{ my_p.ref_number}}").val({{ my_p.price }});*/
			{% endfor %}
			
			
		} );
		
	</script>
{% endblock %}